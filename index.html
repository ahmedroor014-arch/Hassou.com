<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù„Ø¹Ø¨Ø© ØªØ¹Ù„Ù… Ø§Ù„Ù„Ù‡Ø¬Ø§Øª Ø§Ù„ÙØ±Ù†Ø³ÙŠØ©</title>
    <style>
        :root {
            --primary-color: #0084ff;
            --bg-color: #f0f2f5;
            --chat-bg: #ffffff;
            --bot-msg-bg: #e4e6eb;
            --user-msg-bg: #0084ff;
            --user-msg-text: #ffffff;
            --correct-color: #2ecc71;
            --wrong-color: #e74c3c;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            overflow: hidden;
        }

        /* Ø­Ø§ÙˆÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø© (Ø´ÙƒÙ„ Ø§Ù„Ù‡Ø§ØªÙ) */
        #game-container {
            width: 100%;
            max-width: 450px;
            height: 100%;
            max-height: 800px;
            background-color: var(--chat-bg);
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            position: relative;
        }

        /* Ø§Ù„Ø±Ø£Ø³ */
        header {
            background-color: #ffffff;
            padding: 15px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 10;
        }

        header h1 {
            margin: 0;
            font-size: 18px;
            color: #333;
        }

        header .score {
            font-weight: bold;
            color: var(--primary-color);
        }

        #restart-btn {
            background: none;
            border: 1px solid #ccc;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 12px;
            transition: 0.3s;
        }
        #restart-btn:hover {
            background: #eee;
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¯Ø±Ø¯Ø´Ø© */
        #chat-area {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 10px;
            scroll-behavior: smooth;
        }

        .message {
            max-width: 80%;
            padding: 10px 15px;
            border-radius: 18px;
            font-size: 15px;
            line-height: 1.4;
            position: relative;
            animation: popIn 0.3s ease-out;
        }

        @keyframes popIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .bot-message {
            background-color: var(--bot-msg-bg);
            color: #050505;
            align-self: flex-start;
            border-bottom-right-radius: 18px;
            border-bottom-left-radius: 4px;
        }

        .user-message {
            background-color: var(--user-msg-bg);
            color: var(--user-msg-text);
            align-self: flex-end;
            border-bottom-left-radius: 18px;
            border-bottom-right-radius: 4px;
            text-align: left; /* Ø§Ù„ÙØ±Ù†Ø³ÙŠØ© Ù…Ù† Ø§Ù„ÙŠØ³Ø§Ø± */
            direction: ltr;
        }

        .feedback-correct {
            border: 2px solid var(--correct-color);
        }
        .feedback-wrong {
            border: 2px solid var(--wrong-color);
        }

        /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø¥Ø¯Ø®Ø§Ù„ */
        #input-area {
            padding: 15px;
            background-color: #fff;
            border-top: 1px solid #ddd;
            display: flex;
            gap: 10px;
            justify-content: center;
            align-items: center;
        }

        .accent-btn {
            flex: 1;
            padding: 15px;
            font-size: 24px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.1s, background 0.3s;
            font-family: sans-serif;
        }

        .accent-btn:active {
            transform: scale(0.95);
        }

        .accent-btn:hover {
            background-color: #006bcf;
        }

        .accent-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        /* Ù…Ø¤Ø´Ø± Ø§Ù„ÙƒØªØ§Ø¨Ø© */
        .typing-indicator {
            font-style: italic;
            color: #888;
            font-size: 12px;
            margin-bottom: 5px;
            display: none;
            align-self: flex-start;
            margin-right: 15px;
        }

        /* ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†ØµÙˆØµ Ø§Ù„ÙØ±Ù†Ø³ÙŠØ© Ø¯Ø§Ø®Ù„ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ */
        .fr-text {
            font-family: 'Arial', sans-serif;
            font-weight: bold;
            direction: ltr;
            display: inline-block;
        }

    </style>
</head>
<body>

<div id="game-container">
    <header>
        <button id="restart-btn" onclick="restartGame()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ø¯Ø¡</button>
        <h1>Professeur FranÃ§ais</h1>
        <div class="score">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score-val">0</span></div>
    </header>

    <div id="chat-area">
        <!-- Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø³ØªØ¸Ù‡Ø± Ù‡Ù†Ø§ -->
    </div>
    <div class="typing-indicator" id="typing-indicator">Ø§Ù„Ù…Ø¹Ù„Ù… ÙŠÙƒØªØ¨...</div>

    <div id="input-area">
        <button class="accent-btn" onclick="handleInput('Ã©')">Ã©</button>
        <button class="accent-btn" onclick="handleInput('Ã¨')">Ã¨</button>
        <button class="accent-btn" onclick="handleInput('Ãª')">Ãª</button>
    </div>
</div>

<script>
    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù„Ø¹Ø¨Ø© ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰
    const lessonContent = [
        "Ù…Ø±Ø­Ø¨Ø§Ù‹! Ø£Ù†Ø§ Ù…Ø¹Ù„Ù…Ùƒ Ø§Ù„ÙØ±Ù†Ø³ÙŠ. Ø³Ø£Ø¹Ù„Ù…Ùƒ Ø§Ù„ÙŠÙˆÙ… Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ù„Ù‡Ø¬Ø§Øª (Les accents).",
        "1) Accent Aigu (Ã©): ØªÙˆØ¶Ø¹ Ø¹Ø§Ø¯Ø© Ø¹Ù„Ù‰ Ø­Ø±Ù e Ù„ØªØ¹Ø·ÙŠ ØµÙˆØªØ§Ù‹ Ø­Ø§Ø¯Ø§Ù‹. <br>Ù…Ø«Ø§Ù„: <span class='fr-text'>cafÃ© - Ã©cole</span>.",
        "2) Accent Grave (Ã¨): ØªÙˆØ¶Ø¹ Ù„ØªØ¹Ø·ÙŠ ØµÙˆØªØ§Ù‹ Ù…ÙØªÙˆØ­Ø§Ù‹ ÙˆØ¹Ù…ÙŠÙ‚Ø§Ù‹. <br>Ù…Ø«Ø§Ù„: <span class='fr-text'>pÃ¨re - mÃ¨re - frÃ¨re</span>.",
        "3) Accent Circonflexe (Ãª): ØªÙˆØ¶Ø¹ Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ Ù„Ù„Ø¯Ù„Ø§Ù„Ø© Ø¹Ù„Ù‰ Ø­Ø±Ù Ù…Ø­Ø°ÙˆÙ Ù‚Ø¯ÙŠÙ…Ø§Ù‹. <br>Ù…Ø«Ø§Ù„: <span class='fr-text'>forÃªt - bÃªte - tÃªte</span>.",
        "Ù‡Ù„ Ø£Ù†Øª Ù…Ø³ØªØ¹Ø¯ØŸ Ø³Ø£Ø¹Ø·ÙŠÙƒ ÙƒÙ„Ù…Ø§Øª Ù†Ø§Ù‚ØµØ© ÙˆØ¹Ù„ÙŠÙƒ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©!"
    ];

    // Ø¨Ù†Ùƒ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    const questions = [
        { word: "caf_", answer: "Ã©", full: "cafÃ©" },
        { word: "p_re", answer: "Ã¨", full: "pÃ¨re" },
        { word: "for_t", answer: "Ãª", full: "forÃªt" },
        { word: "_cole", answer: "Ã©", full: "Ã©cole" },
        { word: "m_re", answer: "Ã¨", full: "mÃ¨re" },
        { word: "b_te", answer: "Ãª", full: "bÃªte" },
        { word: "fr_re", answer: "Ã¨", full: "frÃ¨re" },
        { word: "t_te", answer: "Ãª", full: "tÃªte" },
        { word: "Ã©t_", answer: "Ã©", full: "Ã©tÃ©" }, // Extra
        { word: "tr_s", answer: "Ã¨", full: "trÃ¨s" } // Extra
    ];

    let currentQuestionIndex = 0;
    let score = 0;
    let isWaitingForAnswer = false;
    let shuffledQuestions = [];

    const chatArea = document.getElementById('chat-area');
    const scoreVal = document.getElementById('score-val');
    const typingIndicator = document.getElementById('typing-indicator');
    const buttons = document.querySelectorAll('.accent-btn');

    // Ø¯Ø§Ù„Ø© Ù„Ø®Ù„Ø· Ø§Ù„Ù…ØµÙÙˆÙØ© (Ø¹Ø´ÙˆØ§Ø¦ÙŠØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©)
    function shuffleArray(array) {
        for (let i = array.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [array[i], array[j]] = [array[j], array[i]];
        }
        return array;
    }

    // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ù„Ù„Ø´Ø§Øª
    function addMessage(text, sender, type = '') {
        const msgDiv = document.createElement('div');
        msgDiv.classList.add('message');
        msgDiv.classList.add(sender === 'bot' ? 'bot-message' : 'user-message');
        
        if (type === 'correct') msgDiv.classList.add('feedback-correct');
        if (type === 'wrong') msgDiv.classList.add('feedback-wrong');

        msgDiv.innerHTML = text;
        chatArea.appendChild(msgDiv);
        chatArea.scrollTop = chatArea.scrollHeight;
    }

    // Ù…Ø­Ø§ÙƒØ§Ø© ÙƒØªØ§Ø¨Ø© Ø§Ù„Ø¨ÙˆØª
    function botSpeak(text, delay = 1000, callback = null) {
        typingIndicator.style.display = 'block';
        chatArea.scrollTop = chatArea.scrollHeight;
        
        setTimeout(() => {
            typingIndicator.style.display = 'none';
            addMessage(text, 'bot');
            if (callback) callback();
        }, delay);
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
    function initGame() {
        chatArea.innerHTML = '';
        score = 0;
        scoreVal.innerText = score;
        currentQuestionIndex = 0;
        shuffledQuestions = shuffleArray([...questions]); // Ù†Ø³Ø® ÙˆØ®Ù„Ø·
        setButtonsState(false); // ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø´Ø±Ø­

        // Ø³Ù„Ø³Ù„Ø© Ø§Ù„Ø´Ø±Ø­
        let delay = 500;
        lessonContent.forEach((msg, index) => {
            setTimeout(() => {
                botSpeak(msg, 1000, () => {
                    // Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø¢Ø®Ø± Ø±Ø³Ø§Ù„Ø© Ø´Ø±Ø­ØŒ Ø§Ø¨Ø¯Ø£ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
                    if (index === lessonContent.length - 1) {
                        setTimeout(askQuestion, 1000);
                    }
                });
            }, delay);
            delay += 2500; // ÙˆÙ‚Øª Ø¨ÙŠÙ† ÙƒÙ„ Ø±Ø³Ø§Ù„Ø© ÙˆØ§Ù„Ø£Ø®Ø±Ù‰
        });
    }

    // Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„
    function askQuestion() {
        if (currentQuestionIndex >= shuffledQuestions.length) {
            endGame();
            return;
        }

        const q = shuffledQuestions[currentQuestionIndex];
        const displayWord = q.word.replace('_', 'â“');
        
        botSpeak(`Ø£ÙƒÙ…Ù„ Ø§Ù„ÙƒÙ„Ù…Ø© Ø§Ù„ØªØ§Ù„ÙŠØ©: <br><h2 class="fr-text" style="margin:5px 0; color:#0084ff">${displayWord}</h2>`, 800, () => {
            isWaitingForAnswer = true;
            setButtonsState(true);
        });
    }

    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    function handleInput(accent) {
        if (!isWaitingForAnswer) return;

        isWaitingForAnswer = false;
        setButtonsState(false);

        // Ø¥Ø¸Ù‡Ø§Ø± Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        addMessage(`<span class="fr-text" style="font-size:20px">${accent}</span>`, 'user');

        const currentQ = shuffledQuestions[currentQuestionIndex];
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø©
        setTimeout(() => {
            if (accent === currentQ.answer) {
                score++;
                scoreVal.innerText = score;
                botSpeak(`âœ… Ø£Ø­Ø³Ù†Øª! Ø§Ù„ÙƒÙ„Ù…Ø© Ù‡ÙŠ: <span class="fr-text">${currentQ.full}</span>`, 600, () => {
                    currentQuestionIndex++;
                    askQuestion();
                });
            } else {
                botSpeak(`âŒ Ø®Ø·Ø£. Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù‡ÙŠ <b>${currentQ.answer}</b>.<br>Ø§Ù„ÙƒÙ„Ù…Ø©: <span class="fr-text">${currentQ.full}</span>`, 800, () => {
                    currentQuestionIndex++;
                    askQuestion();
                });
            }
        }, 500);
    }

    // Ø­Ø§Ù„Ø© Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    function setButtonsState(enabled) {
        buttons.forEach(btn => {
            btn.disabled = !enabled;
            btn.style.opacity = enabled ? '1' : '0.6';
        });
    }

    // Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ù„Ø¹Ø¨Ø©
    function endGame() {
        let finalMsg = `Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©! Ù†ØªÙŠØ¬ØªÙƒ: ${score} Ù…Ù† ${shuffledQuestions.length}.`;
        if (score === shuffledQuestions.length) finalMsg += " ğŸŒŸ Ù…Ù…ØªØ§Ø²!";
        else if (score > shuffledQuestions.length / 2) finalMsg += " ğŸ‘ Ø¬ÙŠØ¯ Ø¬Ø¯Ø§Ù‹.";
        else finalMsg += " Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰ Ù„ØªØ­Ø³ÙŠÙ† Ù…Ø³ØªÙˆØ§Ùƒ.";

        botSpeak(finalMsg, 500);
        botSpeak("Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ 'Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø¨Ø¯Ø¡' ÙÙŠ Ø§Ù„Ø£Ø¹Ù„Ù‰ Ù„Ù„Ø¹Ø¨ Ù…Ø¬Ø¯Ø¯Ø§Ù‹.", 1000);
    }

    // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„ØªØ´ØºÙŠÙ„
    function restartGame() {
        // Ø¥ÙŠÙ‚Ø§Ù Ø£ÙŠ Ù…Ø¤Ù‚ØªØ§Øª Ù…Ø¹Ù„Ù‚Ø© (Ø¨Ø³ÙŠØ·)
        let id = window.setTimeout(function() {}, 0);
        while (id--) {
            window.clearTimeout(id);
        }
        initGame();
    }

    // ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    window.onload = initGame;

</script>

</body>
</html>
